<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Last updated: 2025-08-21T18:19:29Z -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JCHAT - Premium Subscriptions</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&family=Inter:wght@400;600;800&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <style>
        *, *::before, *::after {
            box-sizing: border-box;
        }

        :root {
            --pink: #ff2e92;
            --blue: #00d5ff;
            --glass-black: rgba(10, 10, 10, .75);
            --glass-blue: rgba(0, 213, 255, .15);
            --radius: 20px;
            --transition: .3s ease;
            --white: #fff;
            --text-light: rgba(255, 255, 255, .7);
            --background-main: rgba(10, 10, 10, .75);
            --background-gradient-1: #00d5ff;
            --background-gradient-2: #ff2e92;
            --card-background: linear-gradient(145deg, rgba(255, 255, 255, .03), rgba(255, 255, 255, .01));
            --header-background: linear-gradient(135deg, rgba(10, 10, 20, .85), rgba(10, 10, 20, .75));
            --border-light: rgba(255, 255, 255, .05);
            --input-background: rgba(255, 255, 255, 0.05);
            --button-background: linear-gradient(90deg, var(--blue), var(--pink));
            --button-shadow: 0 4px 15px var(--blue), 0 4px 15px var(--pink);
            
            /* Premium specific colors */
            --premium-gold: #ffd700;
            --premium-silver: #c0c0c0;
            --premium-bronze: #cd7f32;
            --premium-platinum: #e5e4e2;
            --success-green: #4CAF50;
            --warning-orange: #ff9800;
        }

        body {
            min-height: 100vh;
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-x: hidden;
            padding-bottom: 20px;
            background-color: var(--background-main);
            background-image: radial-gradient(circle at top left, var(--background-gradient-1), transparent 100px),
                              radial-gradient(circle at bottom right, var(--background-gradient-2), transparent 150px);
            color: var(--white);
        }

        /* Header security logo sizing */
        .logo img { display:inline-block; vertical-align:middle; }

        .header {
            width: 100%;
            background: var(--header-background);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border-light);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: 800;
            background: linear-gradient(45deg, var(--blue), var(--pink));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-decoration: none;
        }

        .nav ul {
            list-style: none;
            display: flex;
            gap: 2rem;
            margin: 0;
            padding: 0;
        }

        .nav a {
            color: var(--white);
            text-decoration: none;
            transition: var(--transition);
            font-weight: 500;
        }

        .nav a:hover {
            color: var(--blue);
        }

        .main-content {
            max-width: 1200px;
            width: 100%;
            padding: 2rem;
        }

        .hero-section {
            text-align: center;
            margin-bottom: 3rem;
        }

        .hero-section h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
            background: linear-gradient(45deg, var(--blue), var(--pink));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .hero-section p {
            font-size: 1.2rem;
            color: var(--text-light);
            max-width: 600px;
            margin: 0 auto;
        }

        .jcoin-balance-display {
            margin-top: 2rem;
            padding: 1.5rem;
            background: rgba(255, 215, 0, 0.1);
            border: 1px solid var(--premium-gold);
            border-radius: var(--radius);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .jcoin-balance {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.1rem;
            color: var(--white);
        }

        .jcoin-balance i {
            font-size: 1.5rem;
        }

        .buy-jcoins-btn {
            background: linear-gradient(45deg, var(--premium-gold), var(--pink));
            color: var(--white);
            text-decoration: none;
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius);
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .buy-jcoins-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3);
        }

        .subscription-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .subscription-card {
            background: var(--card-background);
            border: 1px solid var(--border-light);
            border-radius: var(--radius);
            padding: 2rem;
            text-align: center;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .subscription-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .subscription-card.featured {
            border: 2px solid var(--premium-gold);
            transform: scale(1.05);
        }

        .subscription-card.featured::before {
            content: "MOST POPULAR";
            position: absolute;
            top: 1rem;
            right: -2rem;
            background: var(--premium-gold);
            color: #000;
            padding: 0.5rem 2rem;
            transform: rotate(45deg);
            font-size: 0.8rem;
            font-weight: bold;
        }

        .plan-name {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .plan-price {
            font-size: 3rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
        }

        .plan-price .currency {
            font-size: 1.5rem;
            vertical-align: top;
        }

        .plan-price .period {
            font-size: 1rem;
            color: var(--text-light);
        }

        .plan-description {
            color: var(--text-light);
            margin-bottom: 2rem;
        }

        .features-list {
            list-style: none;
            padding: 0;
            margin: 0 0 2rem 0;
            text-align: left;
        }

        .features-list li {
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--border-light);
        }

        .features-list li:last-child {
            border-bottom: none;
        }

        .features-list li i {
            color: var(--success-green);
            margin-right: 0.5rem;
            width: 20px;
        }

        .subscribe-btn {
            width: 100%;
            padding: 1rem 2rem;
            background: var(--button-background);
            border: none;
            border-radius: var(--radius);
            color: var(--white);
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--button-shadow);
        }

        .subscribe-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
        }

        .subscribe-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .current-plan-badge {
            background: var(--success-green);
            color: var(--white);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .jcoin-integration {
            background: var(--card-background);
            border: 1px solid var(--border-light);
            border-radius: var(--radius);
            padding: 2rem;
            margin-top: 2rem;
        }

        .jcoin-integration h3 {
            color: var(--premium-gold);
            margin-bottom: 1rem;
        }

        .jcoin-packages {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .jcoin-package {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-light);
            border-radius: var(--radius);
            padding: 1rem;
            text-align: center;
        }

        .jcoin-amount {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--premium-gold);
        }

        .jcoin-price {
            color: var(--text-light);
            margin-top: 0.5rem;
        }

        .jcoin-purchase-btn {
            background: linear-gradient(45deg, var(--blue), var(--pink));
            color: var(--white);
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 1rem;
            width: 100%;
            justify-content: center;
        }

        .jcoin-purchase-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 213, 255, 0.3);
        }

        .message-box {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            border-radius: var(--radius);
            color: var(--white);
            font-weight: 500;
            z-index: 10000;
            display: none;
            max-width: 300px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .message-box.show {
            display: block;
        }

        .message-box.success {
            background: var(--success-green);
        }

        .message-box.error {
            background: #f44336;
        }

        .message-box.info {
            background: var(--blue);
        }

        .message-box.warning {
            background: var(--warning-orange);
        }

        @media (max-width: 768px) {
            .subscription-grid {
                grid-template-columns: 1fr;
            }
            
            .hero-section h1 {
                font-size: 2rem;
            }
            
            .main-content {
                padding: 1rem;
            }
        }
    </style>
<style id="header-overflow-fix">/*header-overflow-fix*/header .header-content-wrapper{display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:nowrap}header .user-profile-header{display:flex;align-items:center;gap:10px;flex:1 1 auto;min-width:0;justify-content:flex-end}#profileLink{display:inline-flex;align-items:center;column-gap:8px;row-gap:2px;flex-wrap:wrap;max-width:100%;min-width:0}#profileLink #headerDisplayName{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:200px;flex:0 1 auto}#headerProfilePic,#headerAvatarIcon{flex:0 0 auto}@media (max-width:600px){header .header-content-wrapper{gap:8px}#profileLink{column-gap:6px}}</style></head>
<body>
    <header class="header">
        <div class="header-content">
            <a href="/home.html" class="logo" style="display:flex;align-items:center;gap:10px">
                <img src="assets/security.png" alt="JCHAT Security" style="height:24px;width:auto" onerror="this.style.display='none'">
                <span>Nuvia</span>
            </a>
            <nav class="nav">
                <ul>
                    <li><a href="/home.html">Home</a></li>
                    <li><a href="/profile.html">Profile</a></li>
                    <li><a href="/wallet.html">Wallet</a></li>
                    <li><a href="/jcoin_shop.html">Buy JCoins</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="main-content">
        <div class="hero-section">
            <h1>Unlock Premium Features</h1>
            <p>Enhance your JCHAT experience with exclusive features, premium themes, and advanced tools</p>
            
            <!-- JCoin Balance Display -->
            <div class="jcoin-balance-display">
                <div class="jcoin-balance">
                    <i class="fas fa-coins" style="color: var(--premium-gold);"></i>
                    <span>Your Balance: <strong id="userJCoins">0</strong> JCoins</span>
                </div>
                <a href="/jcoin_shop.html" class="buy-jcoins-btn">
                    <i class="fas fa-plus"></i> Buy More JCoins
                </a>
            </div>
        </div>

        <div class="subscription-grid">
            <!-- Basic Premium -->
            <div class="subscription-card">
                <div class="plan-name">Basic Premium</div>
                <div class="plan-price">
                    <span class="currency">₦</span>499
                    <span class="period">/month</span>
                </div>
                <div class="plan-description">Perfect for casual users who want enhanced features</div>
                
                <ul class="features-list">
                    <li><i class="fas fa-check"></i> Premium themes (8+ exclusive themes)</li>
                    <li><i class="fas fa-check"></i> Custom profile frames</li>
                    <li><i class="fas fa-check"></i> Priority customer support</li>
                    <li><i class="fas fa-check"></i> Ad-free experience</li>
                    <li><i class="fas fa-check"></i> 100 JCoins monthly bonus</li>
                </ul>
                
                <button class="subscribe-btn" onclick="subscribeToPlan('basic')">
                    Subscribe Now
                </button>
            </div>

            <!-- Pro Premium -->
            <div class="subscription-card featured">
                <div class="plan-name">Pro Premium</div>
                <div class="plan-price">
                    <span class="currency">₦</span>999
                    <span class="period">/month</span>
                </div>
                <div class="plan-description">Best value for power users and content creators</div>
                
                <ul class="features-list">
                    <li><i class="fas fa-check"></i> All Basic features</li>
                    <li><i class="fas fa-check"></i> All premium themes included</li>
                    <li><i class="fas fa-check"></i> Advanced analytics dashboard</li>
                    <li><i class="fas fa-check"></i> Unlimited groups creation</li>
                    <li><i class="fas fa-check"></i> Custom emoji packs</li>
                    <li><i class="fas fa-check"></i> 250 JCoins monthly bonus</li>
                    <li><i class="fas fa-check"></i> Priority chat features</li>
                </ul>
                
                <button class="subscribe-btn" onclick="subscribeToPlan('pro')">
                    Subscribe Now
                </button>
            </div>

            <!-- Enterprise -->
            <div class="subscription-card">
                <div class="plan-name">Enterprise</div>
                <div class="plan-price">
                    <span class="currency">₦</span>1999
                    <span class="period">/month</span>
                </div>
                <div class="plan-description">Complete solution for businesses and teams</div>
                
                <ul class="features-list">
                    <li><i class="fas fa-check"></i> All Pro features</li>
                    <li><i class="fas fa-check"></i> Team management tools</li>
                    <li><i class="fas fa-check"></i> Advanced moderation tools</li>
                    <li><i class="fas fa-check"></i> Custom branding options</li>
                    <li><i class="fas fa-check"></i> API access</li>
                    <li><i class="fas fa-check"></i> 500 JCoins monthly bonus</li>
                    <li><i class="fas fa-check"></i> Dedicated support</li>
                </ul>
                
                <button class="subscribe-btn" onclick="subscribeToPlan('enterprise')">
                    Subscribe Now
                </button>
            </div>
        </div>

        <div class="jcoin-integration">
            <h3><i class="fas fa-coins"></i> JCoin Integration</h3>
            <p>All premium subscriptions include monthly JCoin bonuses. You can also purchase additional JCoins separately.</p>
            
            <div class="jcoin-packages">
                <div class="jcoin-package">
                    <div class="jcoin-amount">1000 JCoins</div>
                    <div class="jcoin-price">₦400</div>
                    <button class="jcoin-purchase-btn" onclick="purchaseJCoins(1000, 400)">
                        <i class="fas fa-shopping-cart"></i> Purchase
                    </button>
                </div>
                <div class="jcoin-package">
                    <div class="jcoin-amount">2500 JCoins</div>
                    <div class="jcoin-price">₦1000</div>
                    <button class="jcoin-purchase-btn" onclick="purchaseJCoins(2500, 1000)">
                        <i class="fas fa-shopping-cart"></i> Purchase
                    </button>
                </div>
                <div class="jcoin-package">
                    <div class="jcoin-amount">5000 JCoins</div>
                    <div class="jcoin-price">₦2000</div>
                    <button class="jcoin-purchase-btn" onclick="purchaseJCoins(5000, 2000)">
                        <i class="fas fa-shopping-cart"></i> Purchase
                    </button>
                </div>
                <div class="jcoin-package">
                    <div class="jcoin-amount">12500 JCoins</div>
                    <div class="jcoin-price">₦5000</div>
                    <button class="jcoin-purchase-btn" onclick="purchaseJCoins(12500, 5000)">
                        <i class="fas fa-shopping-cart"></i> Purchase
                    </button>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 1rem;">
                <a href="/jcoin_shop.html" class="subscribe-btn" style="display: inline-block; text-decoration: none; margin-top: 1rem;">
                    <i class="fas fa-shopping-cart"></i> Buy JCoins
                </a>
            </div>
        </div>
    </main>

    <div id="messageBox" class="message-box"></div>

    <script>
        // Check if user is logged in and has premium status
        let currentUser = null;
        let userPremiumStatus = null;

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            checkUserAuth();
            loadUserPremiumStatus();
        });

        // Check user authentication
        function checkUserAuth() {
            // This would integrate with your existing auth system
            const user = localStorage.getItem('jchat_user');
            if (user) {
                currentUser = JSON.parse(user);
                updateUIForUser();
            } else {
                // Redirect to login if not authenticated
                window.location.href = '/login.html';
            }
        }

        // Load user's premium status
        function loadUserPremiumStatus() {
            // This would fetch from your database
            // For now, we'll simulate it
            userPremiumStatus = {
                plan: 'none',
                expiresAt: null,
                features: []
            };
            updateSubscriptionUI();
        }

        // Update UI based on user's premium status
        function updateSubscriptionUI() {
            if (userPremiumStatus.plan !== 'none') {
                // Show current plan badge
                const cards = document.querySelectorAll('.subscription-card');
                cards.forEach(card => {
                    const planName = card.querySelector('.plan-name').textContent.toLowerCase();
                    if (planName.includes(userPremiumStatus.plan)) {
                        const badge = document.createElement('div');
                        badge.className = 'current-plan-badge';
                        badge.textContent = 'Current Plan';
                        card.insertBefore(badge, card.firstChild);
                        
                        const btn = card.querySelector('.subscribe-btn');
                        btn.textContent = 'Manage Subscription';
                        btn.onclick = () => manageSubscription(userPremiumStatus.plan);
                    }
                });
            }
        }

        // Confirmation modal utilities
        function showConfirmationModal(title, message, confirmText = 'Proceed', cancelText = 'Cancel') {
            return new Promise((resolve) => {
                let modal = document.getElementById('confirmationModal');
                if (!modal) {
                    modal = document.createElement('div');
                    modal.id = 'confirmationModal';
                    modal.className = 'modal-overlay';
                    modal.innerHTML = `
                        <div class="modal-content">
                            <h3 id="confirmationTitle">Confirm Action</h3>
                            <p id="confirmationMessage">Are you sure?</p>
                            <div class="button-group">
                                <button id="confirmCancelButton" class="modal-button cancel-button" aria-label="Cancel">Cancel</button>
                                <button id="confirmProceedButton" class="modal-button confirm-button" aria-label="Proceed">Proceed</button>
                            </div>
                        </div>`;
                    document.body.appendChild(modal);
                }
                const titleEl = modal.querySelector('#confirmationTitle');
                const msgEl = modal.querySelector('#confirmationMessage');
                const cancelBtn = modal.querySelector('#confirmCancelButton');
                const proceedBtn = modal.querySelector('#confirmProceedButton');
                if (titleEl) titleEl.textContent = title || 'Confirm Action';
                if (msgEl) msgEl.textContent = message || 'Are you sure?';
                if (cancelBtn) cancelBtn.textContent = cancelText;
                if (proceedBtn) proceedBtn.textContent = confirmText;
                modal.style.display = 'flex';
                const onCancel = () => { cleanup(); resolve(false); };
                const onProceed = () => { cleanup(); resolve(true); };
                function cleanup() {
                    modal.style.display = 'none';
                    cancelBtn.removeEventListener('click', onCancel);
                    proceedBtn.removeEventListener('click', onProceed);
                    modal.removeEventListener('click', onOutside);
                }
                function onOutside(e) { if (e.target === modal) onCancel(); }
                cancelBtn.addEventListener('click', onCancel);
                proceedBtn.addEventListener('click', onProceed);
                modal.addEventListener('click', onOutside);
            });
        }

        // Basic modal styles (scoped)
        const confirmationStyles = document.createElement('style');
        confirmationStyles.textContent = `
            #confirmationModal.modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: none; align-items: center; justify-content: center; z-index: 2000; }
            #confirmationModal .modal-content { background: var(--header-background); border: 1px solid var(--border-light); border-radius: var(--radius); padding: 1.5rem; max-width: 420px; width: calc(100% - 32px); box-shadow: 0 10px 30px rgba(0,0,0,0.4); }
            #confirmationModal h3 { margin: 0 0 .5rem; font-family: 'Poppins', sans-serif; }
            #confirmationModal p { margin: 0 0 1rem; color: var(--text-light); }
            #confirmationModal .button-group { display: flex; gap: .75rem; justify-content: center; }
            #confirmationModal .modal-button { padding: .6rem 1rem; border-radius: 10px; border: 1px solid var(--border-light); cursor: pointer; background: var(--card-background); color: var(--white); }
            #confirmationModal .confirm-button { background: var(--button-background); box-shadow: var(--button-shadow); border: none; }
        `;
        document.head.appendChild(confirmationStyles);

        // Subscribe to a premium plan
        async function subscribeToPlan(planType) {
            if (!currentUser) {
                showMessage('Please log in to subscribe', 'error');
                return;
            }

            const planDetails = getPlanDetails(planType);
            if (!planDetails) {
                showMessage('Invalid plan selected', 'error');
                return;
            }

            const ok = await showConfirmationModal(
                'Subscribe',
                `Subscribe to ${planDetails.name} for ₦${planDetails.price}/month? This will redirect you to complete your payment.`,
                'Subscribe',
                'Cancel'
            );
            if (ok) processSubscription(planType);
        }

        // Get plan details
        function getPlanDetails(planType) {
            const plans = {
                basic: { name: 'Basic Premium', price: 499, jcoins: 100 },
                pro: { name: 'Pro Premium', price: 999, jcoins: 250 },
                enterprise: { name: 'Enterprise', price: 1999, jcoins: 500 }
            };
            return plans[planType];
        }

        // Process subscription
        function processSubscription(planType) {
            const planDetails = getPlanDetails(planType);
            
            // Show loading state
            showMessage('Processing subscription...', 'info');
            
            // Simulate payment processing
            setTimeout(() => {
                // In real implementation, this would integrate with payment gateway
                showPaymentInstructions(planType, planDetails);
            }, 1000);
        }

        // Show payment instructions
        function showPaymentInstructions(planType, planDetails) {
            const opay = (window.BANK_DETAILS?.opay) || { bank: 'OPay', accountNumber: '8111609765', accountName: 'Elechi Joshua' };
            const message = `
                To complete your ${planDetails.name} subscription:
                
                1. Transfer ₦${planDetails.price} to:
                   Bank: ${opay.bank}
                   Account: ${opay.accountNumber}
                   Name: ${opay.accountName}
                
                2. Send payment proof to WhatsApp: 08111609765
                
                3. Include your User ID: ${currentUser?.uid || 'N/A'}
                
                Your subscription will be activated after payment verification.
            `;
            
            alert(message);
            showMessage('Payment instructions sent!', 'success');
        }

        // Manage existing subscription
        function manageSubscription(planType) {
            showMessage('Subscription management coming soon!', 'info');
        }

        // Update UI for logged-in user
        function updateUIForUser() {
            // Update any user-specific UI elements
            console.log('User authenticated:', currentUser);
        }

        // Show message
        function showMessage(message, type = 'info') {
            const messageBox = document.getElementById('messageBox');
            messageBox.textContent = message;
            messageBox.className = `message-box show ${type}`;
            
            setTimeout(() => {
                messageBox.classList.remove('show');
            }, 5000);
        }
    </script>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
        import { getAuth, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js';
        import { getFirestore, collection, doc, setDoc, getDoc, updateDoc, serverTimestamp, addDoc } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js';

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDz-8N0totzvMCvonF9pKj9RsoH3J8xL0w",
            authDomain: "jchat-1.firebaseapp.com",
            databaseURL: "https://jchat-1-default-rtdb.firebaseio.com",
            projectId: "jchat-1",
            storageBucket: "jchat-1.firebasestorage.app",
            messagingSenderId: "328479683167",
            appId: "1:328479683167:web:276c0b7e8ea44dd2d6a1ea",
            measurementId: "G-S6Z9GG0R9P"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = 'default-app-id';

        // Global variables
        let currentUser = null;
        let userPremiumStatus = null;
        let userJCoins = 0;
        let isProcessing = false;

        // Plan details - matching Home.html premium features
        const plans = {
            basic: { 
                name: 'Basic Premium', 
                price: 499, 
                jcoins: 100,
                features: ['Premium themes (8+ exclusive themes)', 'Custom profile frames', 'Priority customer support', 'Ad-free experience', '100 JCoins monthly bonus', 'Advanced post features', 'Custom emoji access']
            },
            pro: { 
                name: 'Pro Premium', 
                price: 999, 
                jcoins: 250,
                features: ['All Basic features', 'All premium themes included', 'Advanced analytics dashboard', 'Unlimited groups creation', 'Custom emoji packs', '250 JCoins monthly bonus', 'Priority chat features', 'Enhanced moderation tools']
            },
            enterprise: { 
                name: 'Enterprise', 
                price: 1999, 
                jcoins: 500,
                features: ['All Pro features', 'Team management tools', 'Advanced moderation tools', 'Custom branding options', 'API access', '500 JCoins monthly bonus', 'Dedicated support', 'White-label solutions']
            }
        };

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            checkUserAuth();
        });

        // Check user authentication
        function checkUserAuth() {
            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    currentUser = user;
                    await loadUserPremiumStatus();
                    updateSubscriptionUI();
                } else {
                    // Redirect to login if not authenticated
                    window.location.href = '/Login.html';
                }
            });
        }

        // Load user premium status - integrated with Home.html profile system
        async function loadUserPremiumStatus() {
            try {
                // Check user's private profile for premium status (Home.html structure)
                const userProfileRef = doc(db, `artifacts/${appId}/users/${currentUser.uid}/profiles/user_profile`);
                const userProfileDoc = await getDoc(userProfileRef);
                
                if (userProfileDoc.exists()) {
                    const profileData = userProfileDoc.data();
                    userPremiumStatus = profileData.premiumStatus || null;
                    userJCoins = profileData.jCoins || 0;
                } else {
                    // Create user profile if it doesn't exist (Home.html structure)
                    await setDoc(userProfileRef, {
                        username: currentUser.displayName || `User_${currentUser.uid.substring(0, 8)}`,
                        email: currentUser.email || "",
                        profilePicId: currentUser.photoURL || null,
                        bio: "",
                        location: "",
                        friendsCount: 0,
                        followersCount: 0,
                        followingCount: 0,
                        createdAt: serverTimestamp(),
                        updatedAt: serverTimestamp(),
                        inspirationType: "motivational",
                        visibility: {
                            displayName: true, profilePic: true, bio: false, location: false,
                            emailPublic: false, allowFriendRequests: true, allowMessages: true,
                        },
                        totalPosts: 0,
                        jCoins: 0,
                        gas: 0,
                        level: 1,
                        currentXp: 0,
                        xpToNextLevel: 100,
                        lastLoginBonusClaimed: null,
                        inCall: false,
                        premiumStatus: null
                    });
                    userPremiumStatus = null;
                }
            } catch (error) {
                console.error('Error loading user premium status:', error);
                showMessage('Error loading user data', 'error');
            }
        }

        // Update subscription UI - integrated with Home.html JCoin system
        function updateSubscriptionUI() {
            // Remove any existing current plan badges
            document.querySelectorAll('.current-plan-badge').forEach(badge => badge.remove());
            
            // Update JCoin display
            const jcoinDisplay = document.getElementById('userJCoins');
            if (jcoinDisplay) {
                jcoinDisplay.textContent = userJCoins;
            }
            
            if (userPremiumStatus) {
                const planCard = document.querySelector(`[data-plan="${userPremiumStatus.plan}"]`);
                if (planCard) {
                    const badge = document.createElement('div');
                    badge.className = 'current-plan-badge';
                    badge.textContent = 'Current Plan';
                    badge.style.cssText = 'background: var(--success-green); color: white; padding: 0.5rem 1rem; border-radius: 20px; font-size: 0.9rem; font-weight: 600; text-align: center; margin-top: 1rem;';
                    planCard.appendChild(badge);
                    
                    // Change button text
                    const button = planCard.querySelector('.subscribe-btn');
                    if (button) {
                        button.textContent = 'Manage Subscription';
                        button.onclick = () => manageSubscription(userPremiumStatus.plan);
                    }
                }
            }
        }

        // Subscribe to plan
        function subscribeToPlan(planType) {
            if (isProcessing) return;
            if (!currentUser) {
                showMessage('Please log in to subscribe', 'error');
                return;
            }
            if (!plans[planType]) {
                showMessage('Invalid plan selected', 'error');
                return;
            }
            if (userPremiumStatus && userPremiumStatus.plan === planType) {
                showMessage('You already own this plan', 'info');
                return;
            }
            
            processSubscription(planType, plans[planType]);
        }

        // Process subscription - integrated with Home.html JCoin system
        async function processSubscription(planType, planDetails) {
            isProcessing = true;
            setButtonLoading(planType, true);
            
            try {
                // Create subscription document
                const subscriptionData = {
                    userId: currentUser.uid,
                    username: currentUser.displayName || currentUser.email,
                    email: currentUser.email,
                    plan: planType,
                    planName: planDetails.name,
                    amount: planDetails.price,
                    jcoins: planDetails.jcoins,
                    status: 'pending',
                    startDate: serverTimestamp(),
                    endDate: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000), // 30 days from now
                    createdAt: serverTimestamp(),
                    updatedAt: serverTimestamp()
                };

                const subscriptionRef = await addDoc(collection(db, `artifacts/${appId}/public/data/premium_subscriptions`), subscriptionData);

                // Add activity log
                await addDoc(collection(db, `artifacts/${appId}/public/data/premium_activity`), {
                    userId: currentUser.uid,
                    username: currentUser.displayName || currentUser.email,
                    activityType: 'subscription',
                    title: `Subscribed to ${planDetails.name}`,
                    description: `User subscribed to ${planDetails.name} plan`,
                    amount: planDetails.price,
                    plan: planType,
                    subscriptionId: subscriptionRef.id,
                    timestamp: serverTimestamp()
                });

                // Update user's premium status in their profile (for Home.html integration)
                const userProfileRef = doc(db, `artifacts/${appId}/users/${currentUser.uid}/profiles/user_profile`);
                await updateDoc(userProfileRef, {
                    premiumStatus: {
                        plan: planType,
                        planName: planDetails.name,
                        startDate: serverTimestamp(),
                        endDate: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000),
                        subscriptionId: subscriptionRef.id,
                        status: 'pending'
                    },
                    updatedAt: serverTimestamp()
                });

                showPaymentInstructions(planType, planDetails, subscriptionRef.id);
                
            } catch (error) {
                console.error('Error processing subscription:', error);
                showMessage('Error processing subscription. Please try again.', 'error');
            } finally {
                isProcessing = false;
                setButtonLoading(planType, false);
            }
        }

        // Set button loading state
        function setButtonLoading(planType, isLoading) {
            const button = document.getElementById(`${planType}Btn`);
            if (button) {
                button.disabled = isLoading;
                const btnText = button.querySelector('.btn-text');
                const spinner = button.querySelector('.loading-spinner');
                
                if (isLoading) {
                    btnText.textContent = 'Processing...';
                    spinner.style.display = 'inline-block';
                } else {
                    btnText.textContent = 'Subscribe Now';
                    spinner.style.display = 'none';
                }
            }
        }

        // Show payment instructions
        function showPaymentInstructions(planType, planDetails, subscriptionId) {
            alert(`Payment Instructions for ${planDetails.name}:
            
Your User ID: ${currentUser.uid}
Subscription ID: ${subscriptionId}
Amount: ₦${planDetails.price}

Please contact support to complete your payment and activate your subscription.`);
            
            showMessage(`Subscription created successfully! Please contact support to complete payment.`, 'success');
        }

        // Manage subscription
        function manageSubscription(planType) {
            showMessage('Subscription management features coming soon. Please contact support for assistance.', 'info');
        }

        // Purchase JCoins - integrated with Home.html JCoin system
        async function purchaseJCoins(amount, price) {
            if (isProcessing) return;
            if (!currentUser) {
                showMessage('Please log in to purchase JCoins', 'error');
                return;
            }
            
            isProcessing = true;
            
            try {
                // Create JCoin purchase record
                const purchaseData = {
                    userId: currentUser.uid,
                    username: currentUser.displayName || currentUser.email,
                    email: currentUser.email,
                    jcoins: amount,
                    amount: price,
                    status: 'pending',
                    createdAt: serverTimestamp(),
                    updatedAt: serverTimestamp()
                };

                const purchaseRef = await addDoc(collection(db, `artifacts/${appId}/public/data/jcoin_purchases`), purchaseData);

                // Add activity log
                await addDoc(collection(db, `artifacts/${appId}/public/data/premium_activity`), {
                    userId: currentUser.uid,
                    username: currentUser.displayName || currentUser.email,
                    activityType: 'jcoin_purchase',
                    title: `Purchased ${amount} JCoins`,
                    description: `User purchased ${amount} JCoins for ₦${price}`,
                    amount: price,
                    jcoins: amount,
                    purchaseId: purchaseRef.id,
                    timestamp: serverTimestamp()
                });

                showMessage(`JCoin purchase created successfully! Please contact support to complete payment.`, 'success');
                
            } catch (error) {
                console.error('Error processing JCoin purchase:', error);
                showMessage('Error processing purchase. Please try again.', 'error');
            } finally {
                isProcessing = false;
            }
        }

        // Logout
        function handleLogout() {
            signOut(auth).then(() => {
                window.location.href = '/Login.html';
            }).catch((error) => {
                console.error('Error signing out:', error);
                showMessage('Error signing out', 'error');
            });
        }
    </script>
    
</body>
</html>
