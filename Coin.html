<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>JCHAT - Coins</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&family=Inter:wght@400;600;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <style>
    :root { --pink:#ff7ac6; --blue:#6aa7ff; --bg:#0b1220; --panel:#0f172a; --panel-2:#111827; --text:#e5e7eb; --muted:#94a3b8; --border:#1f2937; --border-light:#374151; --shadow:0 10px 30px rgba(0,0,0,.35); --grad: linear-gradient(135deg, var(--pink), var(--blue)); }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:#0b1220;color:var(--text);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;min-height:100%}
    header{position:sticky;top:0;z-index:10;background:linear-gradient(135deg, rgba(10,10,20,.85), rgba(10,10,20,.75));border-bottom:1px solid var(--border);box-shadow:0 4px 15px rgba(0,0,0,.25)}
    .header-inner{max-width:1000px;margin:0 auto;padding:10px 16px;display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
    .brand{display:flex;align-items:center;gap:10px;font-weight:800;letter-spacing:-.02em}
    .brand .title{background-image:var(--grad);-webkit-background-clip:text;background-clip:text;color:transparent;font-family:Poppins,Inter,sans-serif;font-size:18px}
    .balances{display:flex;align-items:center;gap:10px}
    .pill{display:inline-flex;align-items:center;gap:8px;background:rgba(255,255,255,.06);border:1px solid var(--border);padding:6px 10px;border-radius:999px;font-size:12px}
    .pill i{background-image:var(--grad);-webkit-background-clip:text;background-clip:text;color:transparent}
    main{max-width:1000px;margin:16px auto;padding:0 16px;display:grid;gap:16px}
    .panel{background:var(--panel);border:1px solid var(--border);border-radius:16px;box-shadow:var(--shadow);overflow:hidden}
    .panel-hd{padding:14px 16px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
    .panel-title{font-weight:800;font-family:Poppins,Inter,sans-serif;background-image:var(--grad);-webkit-background-clip:text;background-clip:text;color:transparent}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:14px;padding:16px}
    .card{background:var(--panel-2);border:1px solid var(--border);border-radius:14px;padding:16px;display:grid;gap:10px}
    .card h4{margin:0;font-family:Poppins,Inter,sans-serif}
    .btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:10px 12px;border-radius:10px;border:1px solid var(--border);background:var(--panel);color:var(--text);font-weight:600;cursor:pointer;transition:all .2s ease;text-decoration:none}
    .btn:hover{transform:translateY(-1px);border-color:var(--blue);box-shadow:0 6px 18px rgba(0,0,0,.25)}
    .btn.primary{background-image:var(--grad);color:#0b1220;border:0}
    .hint{color:var(--muted);font-size:12px}
    .price{font-size:28px;font-weight:800;font-family:Poppins,Inter,sans-serif}
    .coins{font-weight:700}
    .toast{position:fixed;top:16px;right:16px;background:var(--panel);border:1px solid var(--border);padding:12px 14px;border-radius:10px;box-shadow:var(--shadow);transform:translateX(400px);transition:transform .3s ease;z-index:60}
    .toast.show{transform:translateX(0)}
    .toast.success{border-left:4px solid #10b981}
    .toast.error{border-left:4px solid #ef4444}
    .toast.info{border-left:4px solid var(--blue)}
  </style>
</head>
<body>
  <header>
    <div class="header-inner">
      <div class="brand"><img src="assets/security.png" alt="JCHAT" style="height:24px;width:auto" onerror="this.style.display='none'"><span class="title">JCHAT Coins</span></div>
      <div class="balances">
        <div class="pill" title="Your JCoins"><i class="fas fa-coins"></i><span id="hdrJc">0</span></div>
        <div class="pill" title="Your Gas"><i class="fas fa-bolt"></i><span id="hdrGas">0</span></div>
      </div>
    </div>
  </header>

  <main>
    <section class="panel">
      <div class="panel-hd"><div class="panel-title">Coin Actions</div></div>
      <div class="grid">
        <div class="card">
          <h4>Buy JCoins</h4>
          <div class="hint">Purchase JCoins securely. Orders are reviewed by admins.</div>
          <a class="btn primary" href="#shop"><i class="fas fa-shopping-cart"></i><span>Open JCoin Shop</span></a>
        </div>
        <div class="card">
          <h4>Wallet</h4>
          <div class="hint">View balances, transactions, and manage your wallet.</div>
          <a class="btn" href="/Wallet.html"><i class="fas fa-wallet"></i><span>Go to Wallet</span></a>
        </div>
        <div class="card">
          <h4>Subscriptions</h4>
          <div class="hint">Upgrade experience with premium subscriptions.</div>
          <a class="btn" href="/premium_subscriptions.html"><i class="fas fa-gem"></i><span>View Plans</span></a>
        </div>
        <div class="card">
          <h4>Learn about JCoins</h4>
          <div class="hint">How JCoins work across JCHAT and ways to earn.</div>
          <a class="btn" href="/solution_center.html"><i class="fas fa-circle-info"></i><span>Open Help Center</span></a>
        </div>
      </div>
    </section>

    <section class="panel" id="shop">
      <div class="panel-hd">
        <div>
          <div class="panel-title">JCoin Shop</div>
          <div class="hint">Rate: ₦<span id="rateLabel">—</span>/J • 10% bonus from ₦1,000+</div>
        </div>
        <div class="pill" title="System rate"><i class="fas fa-scale-balanced"></i><span id="ratePill">—</span></div>
      </div>
      <div class="grid" id="shopGrid"></div>
    </section>

    <div class="toast" id="coinToast">Info</div>
  </main>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, onAuthStateChanged, signInWithCustomToken, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getFirestore, doc, getDoc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {
      apiKey: "AIzaSyDz-8N0totzvMCvonF9pKj9RsoH3J8xL0w",
      authDomain: "jchat-1.firebaseapp.com",
      databaseURL: "https://jchat-1-default-rtdb.firebaseio.com",
      projectId: "jchat-1",
      storageBucket: "jchat-1.firebasestorage.app",
      messagingSenderId: "328479683167",
      appId: "1:328479683167:web:276c0b7e8ea44dd2d6a1ea",
      measurementId: "G-S6Z9GG0R9P"
    };
    const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
    const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const hdrJc = document.getElementById('hdrJc');
    const hdrGas = document.getElementById('hdrGas');

    async function ensureAuth(){
      if (auth.currentUser) return;
      try { if (initialAuthToken) await signInWithCustomToken(auth, initialAuthToken); } catch {}
      if (!auth.currentUser) { try { await signInAnonymously(auth); } catch {} }
    }

    async function loadProfile(user){
      try {
        const profRef = doc(db, 'artifacts', appId, 'users', user.uid, 'profiles', 'user_profile');
        const snap = await getDoc(profRef);
        if (!snap.exists()) {
          await setDoc(profRef, { jCoins: 0, gas: 0, username: user.email || 'User', createdAt: serverTimestamp(), updatedAt: serverTimestamp() }, { merge: true });
          hdrJc.textContent = '0'; hdrGas.textContent = '0';
          return;
        }
        const p = snap.data();
        hdrJc.textContent = Number(p.jCoins||0).toLocaleString();
        hdrGas.textContent = Number(p.gas||0).toLocaleString();
      } catch {}
    }

    onAuthStateChanged(auth, async (u)=>{
      if (!u) { await ensureAuth(); return; }
      await loadProfile(u);
    });

    (async ()=>{ await ensureAuth(); })();
  </script>
</body>
</html>
